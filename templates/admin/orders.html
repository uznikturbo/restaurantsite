{% extends "base.html" %}
{% block title %}–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è ‚Äî –ê–¥–º—ñ–Ω{% endblock %}

{% block extra_css %}
<style>
.admin-nav { display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:2.5rem;padding-bottom:1.5rem;border-bottom:1px solid rgba(26,18,8,.08); }
.admin-nav a { padding:.5rem 1.25rem;border-radius:2px;font-size:.78rem;letter-spacing:.08em;text-transform:uppercase;text-decoration:none;border:1px solid rgba(26,18,8,.15);color:rgba(26,18,8,.55);transition:all .2s; }
.admin-nav a:hover { border-color:var(--ink);color:var(--ink); }
.admin-nav a.active { background:var(--ink);color:#fff;border-color:var(--ink); }

.page-head { display:flex;justify-content:space-between;align-items:flex-end;margin-bottom:2.5rem;flex-wrap:wrap;gap:1rem; }
.page-head__eyebrow { font-size:.7rem;letter-spacing:.2em;text-transform:uppercase;color:var(--gold);margin-bottom:.4rem; }
.page-head__title { font-family:'Cormorant Garamond',serif;font-size:2.2rem;font-weight:300; }

.order-card { background:#fff;border:1px solid rgba(26,18,8,.07);border-radius:6px;padding:1.75rem;margin-bottom:1px; }
.order-card:first-child { border-radius:6px 6px 0 0; }
.order-card:last-child { border-radius:0 0 6px 6px; }
.order-card:only-child { border-radius:6px; }
.order-card + .order-card { border-top:none; }
.order-card:hover { background:var(--paper); }

.oc-head { display:flex;align-items:center;gap:1rem;flex-wrap:wrap;margin-bottom:1.25rem;padding-bottom:1.25rem;border-bottom:1px solid rgba(26,18,8,.06); }
.oc-num { font-family:'Cormorant Garamond',serif;font-size:1.3rem;font-weight:400; }
.oc-user { font-size:.83rem;color:rgba(26,18,8,.45);flex:1; }
.oc-badges { display:flex;gap:.5rem;flex-wrap:wrap; }

.oc-details { display:flex;flex-wrap:wrap;gap:.75rem 2rem;margin-bottom:1.25rem;font-size:.85rem;color:rgba(26,18,8,.55); }

.oc-items { list-style:none;border-top:1px solid rgba(26,18,8,.05);padding-top:.75rem;margin-bottom:1rem; }
.oc-items li { display:flex;justify-content:space-between;padding:.3rem 0;font-size:.85rem;color:rgba(26,18,8,.6); }

.oc-footer { display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem; }
.oc-total { font-family:'Cormorant Garamond',serif;font-size:1.5rem;font-weight:300; }

.status-form { display:flex;gap:.5rem;align-items:center; }
.status-form select {
    padding:.45rem .9rem;border:1px solid rgba(26,18,8,.15);border-radius:2px;
    font-size:.8rem;letter-spacing:.04em;cursor:pointer;
    font-family:'DM Sans',sans-serif;color:var(--ink);background:#fff;
    transition:border-color .2s;
}
.status-form select:focus { outline:none;border-color:var(--ink); }

.empty-state { text-align:center;padding:5rem 2rem; }
.empty-state h2 { font-family:'Cormorant Garamond',serif;font-size:2rem;font-weight:300;margin-bottom:.5rem; }
.empty-state p { color:rgba(26,18,8,.45); }
</style>
{% endblock %}

{% block content %}
<nav class="admin-nav">
    <a href="{{ url_for('main.admin_dashboard') }}">–î–∞—à–±–æ—Ä–¥</a>
    <a href="{{ url_for('main.admin_orders') }}" class="active">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</a>
    <a href="{{ url_for('main.admin_products') }}">–¢–æ–≤–∞—Ä–∏</a>
    <a href="{{ url_for('main.admin_users') }}">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ</a>
    <a href="{{ url_for('main.admin_tables') }}">–°—Ç–æ–ª–∏–∫–∏</a>
</nav>

<div class="page-head">
    <div>
        <div class="page-head__eyebrow">–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è</div>
        <h1 class="page-head__title">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</h1>
    </div>
</div>

{% if orders %}
<div>
    {% for o in orders %}
    <div class="order-card">
        <div class="oc-head">
            <span class="oc-num">#{{ o.id }}</span>
            <span class="oc-user">{{ o.user.email }}</span>
            <div class="oc-badges">
                <span class="badge badge--{{ o.status.value }}">{{ o.status.value }}</span>
                <span class="badge badge--{{ o.payment_status.value }}">{{ o.payment_status.value }}</span>
            </div>
        </div>

        <div class="oc-details">
            <span>üìÖ {{ o.created_at.strftime('%d.%m.%Y %H:%M') }}</span>
            <span>üì¶ {{ {'delivery':'–î–æ—Å—Ç–∞–≤–∫–∞','takeaway':'–°–∞–º–æ–≤–∏–≤—ñ–∑','dine_in':'–í —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ñ'}[o.order_type.value] }}</span>
            {% if o.phone %}<span>üìû {{ o.phone }}</span>{% endif %}
            {% if o.delivery_address %}<span>üìç {{ o.delivery_address }}</span>{% endif %}
        </div>

        <ul class="oc-items">
            {% for item in o.items %}
            <li>
                <span>{{ item.product_name }} √ó {{ item.quantity }}</span>
                <span>{{ "%.2f"|format(item.price * item.quantity) }} ‚Ç¥</span>
            </li>
            {% endfor %}
        </ul>

        <div class="oc-footer">
            <span class="oc-total">{{ o.total }} ‚Ç¥</span>
            <form action="{{ url_for('main.admin_change_order_status', order_id=o.id) }}" method="POST" class="status-form">
                {{ status_forms[o.id].hidden_tag() }}
                <select name="status">
                    {% for val, label in [('new','–ù–æ–≤–µ'),('cooking','–ì–æ—Ç—É—î—Ç—å—Å—è'),('ready','–ì–æ—Ç–æ–≤–æ'),('delivered','–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ'),('cancelled','–°–∫–∞—Å–æ–≤–∞–Ω–æ')] %}
                    <option value="{{ val }}" {{ 'selected' if o.status.value == val }}>{{ label }}</option>
                    {% endfor %}
                </select>
                <button type="submit" class="btn btn--primary" style="padding:.45rem 1rem;font-size:.78rem">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
            </form>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="empty-state">
    <h2>–ó–∞–º–æ–≤–ª–µ–Ω—å –ø–æ–∫–∏ –Ω–µ–º–∞—î</h2>
    <p>–ù–æ–≤—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑'—è–≤–ª—è—Ç—å—Å—è —Ç—É—Ç</p>
</div>
{% endif %}
{% endblock %}
