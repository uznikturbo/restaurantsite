{% extends "base.html" %}
{% block title %}{{ position.name }} — 桜 Sakura{% endblock %}

{% block extra_css %}
<style>
.back { font-size:.8rem;letter-spacing:.08em;text-transform:uppercase;color:rgba(26,18,8,.45);text-decoration:none;display:inline-flex;align-items:center;gap:.4rem;margin-bottom:2rem; }
.back:hover { color:var(--red); }

.position-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0;
    border-radius: 6px;
    overflow: hidden;
    border: 1px solid rgba(26,18,8,.08);
    background: #fff;
}

.position-img {
    position: relative;
    aspect-ratio: 1;
}
.position-img img {
    width:100%;height:100%;object-fit:cover;
    display: block;
}

.position-info {
    padding: 3rem;
    display: flex; flex-direction: column;
}

.pos-badge {
    display: inline-flex;
    padding: .22rem .7rem;
    border-radius: 2px;
    font-size: .72rem;
    letter-spacing: .08em;
    text-transform: uppercase;
    margin-bottom: 1.25rem;
    align-self: flex-start;
}
.pos-badge--on { background: #ecfdf5; color: #065f46; }
.pos-badge--off { background: #fef2f2; color: #991b1b; }

.pos-cat {
    font-size: .72rem;
    letter-spacing: .15em;
    text-transform: uppercase;
    color: var(--gold);
    margin-bottom: .6rem;
}

.pos-name {
    font-family: 'Cormorant Garamond', serif;
    font-size: clamp(2rem, 4vw, 3rem);
    font-weight: 300;
    line-height: 1.1;
    margin-bottom: .75rem;
}

.pos-rating {
    display: flex; align-items: center; gap: .75rem;
    margin-bottom: 1.5rem;
}
.pos-rating__stars { color: var(--gold); font-size: 1rem; letter-spacing: 2px; }
.pos-rating__num { font-size:.85rem;color:rgba(26,18,8,.5); }

.pos-desc {
    font-size: .95rem;
    color: rgba(26,18,8,.6);
    line-height: 1.75;
    margin-bottom: 2rem;
    flex: 1;
}

.pos-specs {
    border-top: 1px solid rgba(26,18,8,.06);
    padding-top: 1.5rem;
    margin-bottom: 2rem;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 1rem;
}
.pos-spec {}
.pos-spec__label { font-size:.68rem;letter-spacing:.1em;text-transform:uppercase;color:rgba(26,18,8,.35);margin-bottom:.2rem; }
.pos-spec__val { font-size:.95rem;font-weight:500; }

.pos-price {
    font-family: 'Cormorant Garamond', serif;
    font-size: 3rem;
    font-weight: 300;
    line-height: 1;
    margin-bottom: 1.75rem;
}
.pos-price sup { font-size: 1.1rem; vertical-align: super; }

.pos-actions { display: flex; gap: .75rem; flex-wrap: wrap; }
.pos-actions .btn { flex: 1; justify-content: center; padding: .85rem; }

/* Rating form */
.rating-section {
    border-top: 1px solid rgba(26,18,8,.06);
    padding-top: 1.5rem;
    margin-top: auto;
}
.rating-section__label { font-size:.72rem;letter-spacing:.12em;text-transform:uppercase;color:rgba(26,18,8,.4);margin-bottom:.75rem; }
.stars-form { display:flex;gap:.25rem; }
.stars-form button {
    background: none; border: none;
    font-size: 1.4rem;
    cursor: pointer;
    color: rgba(26,18,8,.15);
    transition: color .15s;
    padding: .1rem .2rem;
}
.stars-form button:hover,
.stars-form button:hover ~ button { color: var(--gold); }

@media (max-width: 780px) {
    .position-grid { grid-template-columns: 1fr; }
    .position-img { aspect-ratio: 16/9; }
    .position-info { padding: 2rem; }
}
</style>
{% endblock %}

{% block content %}
<a href="{{ url_for('main.menu') }}" class="back">← Назад до меню</a>

<div class="position-grid">
    <div class="position-img">
        <img src="{{ position.image_url or 'https://images.unsplash.com/photo-1579584425555-c3ce17fd4351?w=900' }}"
             alt="{{ position.name }}">
    </div>

    <div class="position-info">
        {% if position.category %}
        <div class="pos-cat">{{ position.category.name }}</div>
        {% endif %}

        <span class="pos-badge {{ 'pos-badge--on' if position.is_available else 'pos-badge--off' }}">
            {{ 'Доступно' if position.is_available else 'Недоступно' }}
        </span>

        <h1 class="pos-name">{{ position.name }}</h1>

        <div class="pos-rating">
            <div class="pos-rating__stars">
                {% set r = position.rating | float %}
                {% for i in range(5) %}{{ '★' if i < r|round|int else '☆' }}{% endfor %}
            </div>
            <div class="pos-rating__num">{{ position.rating or '0.0' }} / 5</div>
        </div>

        <p class="pos-desc">{{ position.description or 'Смачна страва японської кухні, приготована з найсвіжіших інгредієнтів нашими шеф-кухарями.' }}</p>

        {% if position.weight or position.calories or position.cooking_time or position.ingredients %}
        <div class="pos-specs">
            {% if position.weight %}
            <div class="pos-spec">
                <div class="pos-spec__label">Вага</div>
                <div class="pos-spec__val">{{ position.weight }} г</div>
            </div>
            {% endif %}
            {% if position.calories %}
            <div class="pos-spec">
                <div class="pos-spec__label">Калорії</div>
                <div class="pos-spec__val">{{ position.calories }} ккал</div>
            </div>
            {% endif %}
            {% if position.cooking_time %}
            <div class="pos-spec">
                <div class="pos-spec__label">Час</div>
                <div class="pos-spec__val">{{ position.cooking_time }} хв</div>
            </div>
            {% endif %}
            {% if position.ingredients %}
            <div class="pos-spec" style="grid-column: 1 / -1;">
                <div class="pos-spec__label">Інгредієнти</div>
                <div class="pos-spec__val" style="font-weight:400;font-size:.88rem;color:rgba(26,18,8,.6)">{{ position.ingredients }}</div>
            </div>
            {% endif %}
        </div>
        {% endif %}

        <div class="pos-price">{{ position.price }}<sup>₴</sup></div>

        <div class="pos-actions">
            {% if current_user.is_authenticated and position.is_available %}
            <form action="{{ url_for('main.add_to_cart', product_id=position.id) }}" method="POST" style="flex:1;margin:0">
                {{ add_form.hidden_tag() }}
                <button type="submit" class="btn btn--primary" style="width:100%">До кошика</button>
            </form>
            {% elif not current_user.is_authenticated %}
            <a href="{{ url_for('main.login') }}" class="btn btn--primary">Увійти для замовлення</a>
            {% endif %}
        </div>

        {% if current_user.is_authenticated %}
        <div class="rating-section">
            <div class="rating-section__label">Ваша оцінка</div>
            <form action="{{ url_for('main.add_rating', product_id=position.id) }}" method="POST" class="stars-form">
                {{ rating_form.hidden_tag() }}
                {% for i in range(5, 0, -1) %}
                <button type="submit" name="rating" value="{{ i }}" title="{{ i }} зірки">★</button>
                {% endfor %}
            </form>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
