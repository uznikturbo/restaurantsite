{% extends "base.html" %}

{% block title %}–ü—Ä–æ—Ñ—ñ–ª—å - Ê°ú„É¨„Çπ„Éà„É©„É≥{% endblock %}

{% block extra_css %}
<style>
    .profile-container {
        max-width: 1200px;
        margin: 2rem auto;
        animation: fadeIn 1s ease;
    }

    .profile-header {
        background: linear-gradient(135deg, var(--primary), #b01f24);
        color: white;
        padding: 3rem;
        border-radius: 25px;
        text-align: center;
        margin-bottom: 2rem;
        animation: slideDown 0.8s ease;
    }

    .profile-avatar {
        width: 120px;
        height: 120px;
        background: white;
        color: var(--primary);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 4rem;
        margin: 0 auto 1rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .profile-name {
        font-family: 'Noto Serif JP', serif;
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
    }

    .profile-email {
        font-size: 1.1rem;
        opacity: 0.9;
    }

    .profile-tabs {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .tab-btn {
        flex: 1;
        padding: 1rem 2rem;
        background: white;
        color: var(--text);
        border: 2px solid var(--primary);
        border-radius: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .tab-btn.active {
        background: var(--primary);
        color: white;
    }

    .tab-btn:hover:not(.active) {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(212, 40, 45, 0.2);
    }

    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
        animation: fadeIn 0.5s ease;
    }

    .orders-list, .reservations-list {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .order-card, .reservation-card {
        background: white;
        padding: 2rem;
        border-radius: 20px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        animation: slideUp 0.5s ease;
        transition: all 0.3s ease;
    }

    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .order-card:hover, .reservation-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(212, 40, 45, 0.15);
    }

    .order-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid #f0f0f0;
    }

    .order-number {
        font-family: 'Noto Serif JP', serif;
        font-size: 1.5rem;
        color: var(--primary);
    }

    .order-status {
        padding: 0.5rem 1rem;
        border-radius: 50px;
        font-weight: 600;
        font-size: 0.9rem;
    }

    .status-new {
        background: #fef3c7;
        color: #92400e;
    }

    .status-cooking {
        background: #dbeafe;
        color: #1e40af;
    }

    .status-ready {
        background: #d1fae5;
        color: #065f46;
    }

    .status-delivered {
        background: #dcfce7;
        color: #166534;
    }

    .status-cancelled {
        background: #fee2e2;
        color: #991b1b;
    }

    .payment-status {
        padding: 0.5rem 1rem;
        border-radius: 50px;
        font-weight: 600;
        font-size: 0.9rem;
    }

    .payment-pending {
        background: #fef3c7;
        color: #92400e;
    }

    .payment-paid {
        background: #d1fae5;
        color: #065f46;
    }

    .payment-failed {
        background: #fee2e2;
        color: #991b1b;
    }

    .order-details {
        margin-top: 1rem;
    }

    .order-items {
        list-style: none;
        margin: 1rem 0;
    }

    .order-item {
        padding: 0.5rem 0;
        display: flex;
        justify-content: space-between;
    }

    .order-total {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--accent);
        text-align: right;
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 2px solid #f0f0f0;
    }

    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        background: white;
        border-radius: 20px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    }

    .empty-state-icon {
        font-size: 5rem;
        margin-bottom: 1rem;
        animation: bounce 2s infinite;
    }

    @keyframes bounce {
        0%, 100% {
            transform: translateY(0);
        }
        50% {
            transform: translateY(-20px);
        }
    }

    .empty-state h2 {
        font-family: 'Noto Serif JP', serif;
        color: var(--primary);
        margin-bottom: 1rem;
    }

    .empty-state p {
        color: #666;
        margin-bottom: 2rem;
    }

    @media (max-width: 768px) {
        .profile-tabs {
            flex-direction: column;
        }

        .order-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 1rem;
        }

        .profile-header {
            padding: 2rem;
        }

        .profile-name {
            font-size: 2rem;
        }

        .order-card, .reservation-card {
            padding: 1.5rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="profile-container">
    <div class="profile-header">
        <div class="profile-avatar">üë§</div>
        <h1 class="profile-name">{{ user.username or '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á' }}</h1>
        <p class="profile-email">{{ user.email }}</p>
    </div>

    <div class="profile-tabs">
        <button class="tab-btn active" onclick="switchTab('orders')">üì¶ –ú–æ—ó –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>
        <button class="tab-btn" onclick="switchTab('reservations')">üìÖ –ú–æ—ó –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è</button>
    </div>

    <div id="orders-tab" class="tab-content active">
        <div class="orders-list">
            {% if orders %}
                {% for order in orders %}
                <div class="order-card">
                    <div class="order-header">
                        <span class="order-number">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è #{{ order.id }}</span>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            <span class="order-status status-{{ order.status.value }}">
                                {{ order.status.value }}
                            </span>
                            <span class="payment-status payment-{{ order.payment_status.value }}">
                                üí≥ {{ order.payment_status.value }}
                            </span>
                        </div>
                    </div>

                    <div class="order-details">
                        <p><strong>üìÖ –î–∞—Ç–∞:</strong> {{ order.created_at.strftime('%d.%m.%Y %H:%M') }}</p>
                        <p><strong>üìç –¢–∏–ø:</strong> {{ order.order_type.value }}</p>
                        {% if order.delivery_address %}
                        <p><strong>üè† –ê–¥—Ä–µ—Å–∞:</strong> {{ order.delivery_address }}</p>
                        {% endif %}
                        {% if order.phone %}
                        <p><strong>üìû –¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ order.phone }}</p>
                        {% endif %}

                        <ul class="order-items">
                            {% for item in order.items %}
                            <li class="order-item">
                                <span>{{ item.product_name }} √ó {{ item.quantity }}</span>
                                <span>{{ item.price * item.quantity }} ‚Ç¥</span>
                            </li>
                            {% endfor %}
                        </ul>

                        <div class="order-total">–í—Å—å–æ–≥–æ: {{ order.total }} ‚Ç¥</div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">üì¶</div>
                    <h2>–£ –≤–∞—Å —â–µ –Ω–µ–º–∞—î –∑–∞–º–æ–≤–ª–µ–Ω—å</h2>
                    <p>–ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ –º–µ–Ω—é —Ç–∞ –æ–±–µ—Ä—ñ—Ç—å —Å–º–∞—á–Ω—ñ —Å—Ç—Ä–∞–≤–∏!</p>
                    <a href="{{ url_for('menu') }}" class="btn-primary" style="margin-top: 1rem; display: inline-block; padding: 1rem 2rem; text-decoration: none;">
                        –î–æ –º–µ–Ω—é
                    </a>
                </div>
            {% endif %}
        </div>
    </div>

    <div id="reservations-tab" class="tab-content">
        <div class="reservations-list">
            {% if reservations %}
                {% for reservation in reservations %}
                <div class="reservation-card">
                    <div class="order-header">
                        <span class="order-number">–ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è #{{ reservation.id }}</span>
                        <span class="order-status status-{{ reservation.status }}">{{ reservation.status }}</span>
                    </div>
                    <div class="order-details">
                        <p><strong>üìÖ –î–∞—Ç–∞:</strong> {{ reservation.reserved_at }}</p>
                        <p><strong>üë• –ì–æ—Å—Ç–µ–π:</strong> {{ reservation.guests }}</p>
                        {% if reservation.table %}
                        <p><strong>ü™ë –°—Ç–æ–ª–∏–∫:</strong> ‚Ññ{{ reservation.table.number }} ({{ reservation.table.seats }} –º—ñ—Å—Ü—å)</p>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">üìÖ</div>
                    <h2>–£ –≤–∞—Å —â–µ –Ω–µ–º–∞—î –±—Ä–æ–Ω—é–≤–∞–Ω—å</h2>
                    <p>–ó–∞–±—Ä–æ–Ω—é–π—Ç–µ —Å—Ç–æ–ª–∏–∫ —É –Ω–∞—à–æ–º—É —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ñ!</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
function switchTab(tab) {
    // Update buttons
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');

    // Update content
    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
    document.getElementById(tab + '-tab').classList.add('active');
}
</script>
{% endblock %}