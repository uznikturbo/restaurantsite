{% extends "base.html" %}
{% block title %}–ü—Ä–æ—Ñ—ñ–ª—å ‚Äî Ê°ú Sakura{% endblock %}

{% block extra_css %}
<style>
.profile-header {
    display: flex; align-items: center; gap: 2rem;
    padding: 2.5rem;
    background: #fff;
    border: 1px solid rgba(26,18,8,.07);
    border-radius: 6px;
    margin-bottom: 2.5rem;
}
.profile-avatar {
    width: 72px; height: 72px;
    background: var(--ink);
    color: #fff;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-family: 'Cormorant Garamond', serif;
    font-size: 2rem;
    font-weight: 300;
    flex-shrink: 0;
}
.profile-info__name { font-family:'Cormorant Garamond',serif;font-size:1.8rem;font-weight:300;margin-bottom:.2rem; }
.profile-info__email { font-size:.85rem;color:rgba(26,18,8,.45); }

/* Tabs */
.tabs { display:flex;gap:0;border-bottom:1px solid rgba(26,18,8,.1);margin-bottom:2rem; }
.tab-btn {
    padding:.75rem 1.75rem;
    background:none;border:none;cursor:pointer;
    font-size:.8rem;letter-spacing:.1em;text-transform:uppercase;
    color:rgba(26,18,8,.45);
    border-bottom:2px solid transparent;
    margin-bottom:-1px;
    transition:all .2s;
}
.tab-btn.active { color:var(--ink);border-bottom-color:var(--ink); }
.tab-btn:hover:not(.active) { color:var(--ink); }

.tab-panel { display:none; }
.tab-panel.active { display:block; }

/* Order cards */
.order-card {
    background:#fff;
    border:1px solid rgba(26,18,8,.07);
    border-radius:6px;
    padding:1.75rem;
    margin-bottom:1rem;
}
.order-card__head {
    display:flex;align-items:center;justify-content:space-between;
    margin-bottom:1.25rem;padding-bottom:1.25rem;
    border-bottom:1px solid rgba(26,18,8,.06);
    flex-wrap:wrap;gap:.75rem;
}
.order-card__num { font-family:'Cormorant Garamond',serif;font-size:1.3rem;font-weight:400; }
.order-card__badges { display:flex;gap:.5rem;flex-wrap:wrap; }

.order-meta { font-size:.85rem;color:rgba(26,18,8,.5);margin-bottom:1rem;display:flex;flex-wrap:wrap;gap:1rem; }
.order-meta span::before { margin-right:.3rem; }

.order-items-list { list-style:none;border-top:1px solid rgba(26,18,8,.06);padding-top:.75rem;margin-top:.75rem; }
.order-items-list li {
    display:flex;justify-content:space-between;
    padding:.35rem 0;font-size:.88rem;
    color:rgba(26,18,8,.65);
    border-bottom:1px solid rgba(26,18,8,.04);
}
.order-items-list li:last-child { border:none; }

.order-total { text-align:right;font-family:'Cormorant Garamond',serif;font-size:1.5rem;font-weight:300;margin-top:.75rem;color:var(--ink); }

/* Reservation */
.res-card {
    background:#fff;border:1px solid rgba(26,18,8,.07);border-radius:6px;
    padding:1.5rem;margin-bottom:.75rem;
    display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem;
}
.res-card__info { display:flex;flex-direction:column;gap:.25rem; }
.res-card__title { font-family:'Cormorant Garamond',serif;font-size:1.2rem;font-weight:400; }
.res-card__sub { font-size:.83rem;color:rgba(26,18,8,.45); }

/* Empty */
.empty-tab { text-align:center;padding:4rem 2rem; }
.empty-tab h3 { font-family:'Cormorant Garamond',serif;font-size:1.8rem;font-weight:300;margin-bottom:.5rem; }
.empty-tab p { font-size:.9rem;color:rgba(26,18,8,.45);margin-bottom:1.5rem; }
</style>
{% endblock %}

{% block content %}
<div class="profile-header">
    <div class="profile-avatar">{{ user.email[0].upper() }}</div>
    <div class="profile-info">
        <div class="profile-info__name">{{ user.username or '–ì—ñ—Å—Ç—å' }}</div>
        <div class="profile-info__email">{{ user.email }}</div>
    </div>
</div>

<div class="tabs">
    <button class="tab-btn active" onclick="switchTab('orders', this)">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>
    <button class="tab-btn" onclick="switchTab('reservations', this)">–ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è</button>
</div>

<!-- Orders -->
<div class="tab-panel active" id="orders">
    {% if orders %}
        {% for o in orders %}
        <div class="order-card">
            <div class="order-card__head">
                <span class="order-card__num">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è #{{ o.id }}</span>
                <div class="order-card__badges">
                    <span class="badge badge--{{ o.status.value }}">{{ o.status.value }}</span>
                    <span class="badge badge--{{ o.payment_status.value }}">{{ o.payment_status.value }}</span>
                </div>
            </div>
            <div class="order-meta">
                <span>üìÖ {{ o.created_at.strftime('%d.%m.%Y %H:%M') }}</span>
                <span>üì¶ {{ {'delivery':'–î–æ—Å—Ç–∞–≤–∫–∞','takeaway':'–°–∞–º–æ–≤–∏–≤—ñ–∑','dine_in':'–í —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ñ'}[o.order_type.value] }}</span>
                {% if o.delivery_address %}<span>üìç {{ o.delivery_address }}</span>{% endif %}
                {% if o.phone %}<span>üìû {{ o.phone }}</span>{% endif %}
            </div>
            <ul class="order-items-list">
                {% for item in o.items %}
                <li>
                    <span>{{ item.product_name }} √ó {{ item.quantity }}</span>
                    <span>{{ "%.2f"|format(item.price * item.quantity) }} ‚Ç¥</span>
                </li>
                {% endfor %}
            </ul>
            <div class="order-total">{{ o.total }} ‚Ç¥</div>
        </div>
        {% endfor %}
    {% else %}
    <div class="empty-tab">
        <h3>–©–µ –Ω–µ–º–∞—î –∑–∞–º–æ–≤–ª–µ–Ω—å</h3>
        <p>–ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ –º–µ–Ω—é —Ç–∞ –æ–±–µ—Ä—ñ—Ç—å —É–ª—é–±–ª–µ–Ω—ñ —Å—Ç—Ä–∞–≤–∏</p>
        <a href="{{ url_for('main.menu') }}" class="btn btn--primary">–í—ñ–¥–∫—Ä–∏—Ç–∏ –º–µ–Ω—é</a>
    </div>
    {% endif %}
</div>

<!-- Reservations -->
<div class="tab-panel" id="reservations">
    {% if reservations %}
        {% for r in reservations %}
        <div class="res-card">
            <div class="res-card__info">
                <div class="res-card__title">
                    {% if r.table %}–°—Ç–æ–ª–∏–∫ ‚Ññ{{ r.table.number }}{% else %}–°—Ç–æ–ª–∏–∫{% endif %}
                </div>
                <div class="res-card__sub">
                    {{ r.reserved_at.strftime('%d.%m.%Y –æ %H:%M') }} ¬∑ {{ r.guests }} –≥–æ—Å—Ç–µ–π
                    {% if r.phone %} ¬∑ {{ r.phone }}{% endif %}
                </div>
                {% if r.comment %}
                <div class="res-card__sub" style="margin-top:.2rem;font-style:italic;">{{ r.comment }}</div>
                {% endif %}
            </div>
            <span class="badge badge--{{ r.status }}">{{ r.status }}</span>
        </div>
        {% endfor %}
    {% else %}
    <div class="empty-tab">
        <h3>–©–µ –Ω–µ–º–∞—î –±—Ä–æ–Ω—é–≤–∞–Ω—å</h3>
        <p>–ó–∞–±—Ä–æ–Ω—é–π—Ç–µ —Å—Ç–æ–ª–∏–∫ –¥–ª—è –æ—Å–æ–±–ª–∏–≤–æ–≥–æ –≤–µ—á–æ—Ä–∞</p>
        <a href="{{ url_for('main.book') }}" class="btn btn--primary">–ó–∞–±—Ä–æ–Ω—é–≤–∞—Ç–∏ —Å—Ç—ñ–ª</a>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
function switchTab(name, btn) {
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById(name).classList.add('active');
}
</script>
{% endblock %}
